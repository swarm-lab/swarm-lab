<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>R vs Python - Round 2 (2/2)</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Welcome to the Swarm Lab where we study Swarm Intelligence in natural and artificial systems.">
    <link rel="canonical" href="http://www.theswarmlab.com/blog/rvspython/r/2014/02/02/r-vs-python-round-2-2/">

    <!-- Custom CSS & Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link rel="stylesheet" href="/style.css">

    <!-- Custom Fonts -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link href="http://fonts.googleapis.com/css?family=Ubuntu:400,700" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-2260031-8', 'auto');
        ga('send', 'pageview');

    </script>

    <!-- Favicon -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/img/favicon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/favicon/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/favicon/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/favicon/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/img/favicon/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/img/favicon/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/img/favicon/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/img/favicon/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/img/favicon/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/img/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/img/favicon/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/img/favicon/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/img/favicon/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/img/favicon/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="/img/favicon/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="/img/favicon/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="/img/favicon/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="/img/favicon/mstile-310x310.png" />

</head>


<body id="nofront" class="index">

<!-- Navigation -->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!--<a class="navbar-brand page-scroll" href="#page-top">Swarm Lab</a>-->
            <a class="navbar-brand page-scroll" href="/">
                <img src="/img/logos/swarmlab.png" alt=Swarm Lab style="height:250%; position: relative; top: -75%;">
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li class="hidden">
                    <a href="#page-top"></a>
                </li>
                <li>
                    <a class="page-scroll" href="/#about">About</a>
                </li>
                <!--<li>
                    <a class="page-scroll" href="#research">Research</a>
                </li>-->

                <li class="dropdown">
                    <a class="dropdown-toggle keep-open" data-toggle="dropdown" data-hover="dropdown" href="/#research">
                        Research<i class="fa fa-angle-down"></i></a>
                    <ul class="dropdown-menu">
                        <li><a class="page-scroll" href="/#research">Current research</a></li>
                        <li><a href="/publications/">Publication list</a></li>
                        <li><a href="/media/">In the media</a></li>
                        <li><a href="/meetings/">Group meetings</a></li>
                    </ul>
                </li>

                <li>
                    <a class="page-scroll" href="/#teaching">Teaching</a>
                </li>
                <!--<li>
                    <a class="page-scroll" href="#dev">Dev</a>
                </li>-->

                <li class="dropdown">
                    <a class="dropdown-toggle keep-open" data-toggle="dropdown" data-hover="dropdown" href="#dev">
                        Dev<i class="fa fa-angle-down"></i></a>
                    <ul class="dropdown-menu">
                        <li><a class="page-scroll" href="#dev">Overview</a></li>
                        <li><a href="/R/">R portfolio</a></li>
                        <li><a href="/shiny/">Shiny portfolio</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a class="dropdown-toggle keep-open" data-toggle="dropdown" data-hover="dropdown" href="/#team">
                        Team<i class="fa fa-angle-down"></i>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="/#team">Current members</a></li>
                        <li><a href="/previous_members/">Previous members</a></li>
                        <li><a href="/join/">Join the lab</a></li>
                    </ul>
                </li>
                <li>
                    <a class="page-scroll" href="/#contact">Contact</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
</nav>


<section class="bg-white post">

    <div class="entry">

        <h2>R vs Python - Round 2 (2/2)</h2>
        <h3></h3>

        <p>Written by Simon Garnier on February 2, 2014</p>

        <hr>

        <p><strong>Text by:</strong> Simon Garnier (<a href="http://www.theswarmlab.com">www.theswarmlab.com</a> / <a href="http://twitter.com/sjmgarnier">@sjmgarnier</a>)</p>

<p><strong>R code by:</strong> Simon Garnier (<a href="http://www.theswarmlab.com">www.theswarmlab.com</a> / <a href="http://twitter.com/sjmgarnier">@sjmgarnier</a>)</p>

<p><strong>Python code by:</strong> Randy Olson (<a href="http://www.randalolson.com">www.randalolson.com</a> / <a href="http://twitter.com/randal_olson">@randal_olson</a>)</p>

<p>Document generated with <a href="http://www.rstudio.com">RStudio</a>, <a href="http://yihui.name/knitr/">knitr</a>, and <a href="http://johnmacfarlane.net/pandoc/">pandoc</a>. Python figures generated with <a href="http://ipython.org/notebook.html">iPython Notebook</a>.</p>

<hr />

<h4 id="foreword">Foreword</h4>

<p>My friend Randy Olson and I got into the habit to argue about the relative qualities of our favorite languages for data analysis and visualization. I am an enthusiastic R user (<a href="http://www.r-project.org">www.r-project.org</a>) while Randy is a fan of Python (<a href="http://www.python.org">www.python.org</a>). One thing we agree on however is that our discussions are meaningless unless we actually put R and Python to a series of tests to showcase their relative strengths and weaknesses. Essentially we will set a common goal (<em>e.g.</em>, perform a particular type of data analysis or draw a particular type of graph) and create the R and Python codes to achieve this goal. And since Randy and I are all about sharing, open source and open access, we decided to make public the results of our friendly challenges so that you can help us decide between R and Python and, hopefully, also learn something along the way.</p>

<hr />

<h4 id="todays-challenge-a-data-thief-manual-for-honest-scientists-part-2-of-2">Today’s challenge: a data thief manual for honest scientists (Part 2 of 2)</h4>

<h5 id="introduction">1 - Introduction</h5>

<p><a href="http://www.theswarmlab.com/r-vs-python-round-2/">Last time</a> we showed you how to scrape data from <a href="http://www.moviebodycounts.com">www.MovieBodyCounts.com</a>. Today, we will finish what we started by retrieving additional information from <a href="http://www.imdb.com">www.imdb.com</a>. In particular, we will attempt to recover the following pieces of information for each of the movies we collected last time: MPAA rating, genre(s), director(s), duration in minutes, IMDb rating and full cast. We will detail the different steps of the process and provide for each step the corresponding code (red boxes for R, green boxes for Python). You will also find the entire codes at the end of this document.</p>

<p>If you think there’s a better way to code this in either language, leave a pull request on our <a href="https://github.com/morpionZ/R-vs-Python/tree/master/Deadliest%20movies%20scrape/code">GitHub repository</a> or leave a note with suggestions in the comments below.</p>

<h5 id="step-by-step-process">2 - Step by step process</h5>

<p>First things first, let’s set up our working environment by loading some necessary libraries.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Load libraries</span><span class="w">
</span><span class="c1"># No additional libraries needed here. Yeah!</span></code></pre></div>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># String parsing libraries
</span><span class="kn">from</span> <span class="nn">imdb</span> <span class="kn">import</span> <span class="n">IMDb</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">re</span></code></pre></div>

<p>Randy is lucky today. Someone else has already written a package (<a href="http://imdbpy.sourceforge.net/">‘IMDbPY’</a>) to scrape data from IMDb. Unfortunately for me, R users are too busy working with serious data sets to take the time to write such a package for my favorite data processing language. <a href="http://had.co.nz/">Hadley Wickham</a> has included a <a href="http://had.co.nz/data/movies/">‘movie’ data set</a> in the <a href="http://ggplot2.org/">ggplot2</a> package that contains some of the information stored on IMDb, but some of the pieces we need for today’s challenge are missing.</p>

<p>Since I am not easily discouraged, I decided to write my own IMDb scraping function (see below). It is not as sophisticated as the Python package Randy is using today, but it does the job until someone else decides to write a more complete R/IMDb package. As you will see, I am using the same scraping technique (XPath) as the one I used in the first part of the challenge.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Create IMDB scraper</span><span class="w">
</span><span class="n">IMDb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># Retrieve movie info from IMDb.com.</span><span class="w">
  </span><span class="c1">#</span><span class="w">
  </span><span class="c1"># Args:</span><span class="w">
  </span><span class="c1">#   ID: IDs of the movies.</span><span class="w">
  </span><span class="c1">#</span><span class="w">
  </span><span class="c1"># Returns:</span><span class="w">
  </span><span class="c1">#   A data frame containing one line per movie, and nine columns: movie ID,</span><span class="w">
  </span><span class="c1">#   film title, year of release, duration in minutes, MPAA rating, genre(s),</span><span class="w">
  </span><span class="c1">#   director(s), IMDb rating, and full cast.</span><span class="w">

  </span><span class="c1"># Load required libraries</span><span class="w">
  </span><span class="n">require</span><span class="p">(</span><span class="n">XML</span><span class="p">)</span><span class="w">
  </span><span class="n">require</span><span class="p">(</span><span class="n">pbapply</span><span class="p">)</span><span class="w">    </span><span class="c1"># Apply functions with progress bars!!!</span><span class="w">

  </span><span class="c1"># Wrap core of the function in do.call and pblapply in order to</span><span class="w">
  </span><span class="c1"># pseudo-vectorize it (pblapply) and return a data frame (do.call)</span><span class="w">
  </span><span class="n">info</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span><span class="w"> </span><span class="n">pblapply</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># Create movie URL on IMDb.com</span><span class="w">
    </span><span class="n">URL</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"http://www.imdb.com/title/tt"</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="p">)</span><span class="w">

    </span><span class="c1"># Download and parse HTML of IMDb page</span><span class="w">
    </span><span class="n">parsed.html</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">htmlParse</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span><span class="w">

    </span><span class="c1"># Find title</span><span class="w">
    </span><span class="n">Film</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">parsed.html</span><span class="p">,</span><span class="w"> </span><span class="s2">"//h1[@class='header']/span[@class='itemprop']"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">)</span><span class="w">

    </span><span class="c1"># Find year</span><span class="w">
    </span><span class="n">Year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"[^0-9]"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">parsed.html</span><span class="p">,</span><span class="w"> </span><span class="s2">"//h1[@class='header']/span[@class='nobr']"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">)))</span><span class="w">

    </span><span class="c1"># Find duration in minutes</span><span class="w">
    </span><span class="n">Length_Minutes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"[^0-9]"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">parsed.html</span><span class="p">,</span><span class="w"> </span><span class="s2">"//div[@class='infobar']/time[@itemprop='duration']"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">)))</span><span class="w">

    </span><span class="c1"># Find MPAA rating</span><span class="w">
    </span><span class="n">MPAA_Rating</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unname</span><span class="p">(</span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">parsed.html</span><span class="p">,</span><span class="w"> </span><span class="s2">"//div[@class='infobar']/span/@content"</span><span class="p">))</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">is.character</span><span class="p">(</span><span class="n">MPAA_Rating</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">   </span><span class="c1"># Some movies don't have a MPAA rating</span><span class="w">
      </span><span class="n">MPAA_Rating</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"UNRATED"</span><span class="w">
    </span><span class="p">}</span><span class="w">

    </span><span class="c1"># Find genre</span><span class="w">
    </span><span class="n">Genre</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">parsed.html</span><span class="p">,</span><span class="w"> </span><span class="s2">"//span[@class='itemprop' and @itemprop='genre']"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s1">'|'</span><span class="p">)</span><span class="w">

    </span><span class="c1"># Find director</span><span class="w">
    </span><span class="n">Director</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">parsed.html</span><span class="p">,</span><span class="w"> </span><span class="s2">"//div[@itemprop='director']/a"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s1">'|'</span><span class="p">)</span><span class="w">

    </span><span class="c1"># Find IMDB rating</span><span class="w">
    </span><span class="n">IMDB_rating</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">parsed.html</span><span class="p">,</span><span class="w"> </span><span class="s2">"//div[@class='titlePageSprite star-box-giga-star']"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">))</span><span class="w">

    </span><span class="c1"># Extract full cast from the full credits page</span><span class="w">
    </span><span class="n">parsed.html</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">htmlParse</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span><span class="s2">"/fullcredits"</span><span class="p">))</span><span class="w">
    </span><span class="n">Full_Cast</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">xpathSApply</span><span class="p">(</span><span class="n">parsed.html</span><span class="p">,</span><span class="w"> </span><span class="s2">"//span[@itemprop='name']"</span><span class="p">,</span><span class="w"> </span><span class="n">xmlValue</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s1">'|'</span><span class="p">)</span><span class="w">

    </span><span class="n">data.frame</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">Film</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Film</span><span class="p">,</span><span class="w"> </span><span class="n">Year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Length_Minutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Length_Minutes</span><span class="p">,</span><span class="w">
               </span><span class="n">MPAA_Rating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPAA_Rating</span><span class="p">,</span><span class="w"> </span><span class="n">Genre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Genre</span><span class="p">,</span><span class="w">
               </span><span class="n">Director</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Director</span><span class="p">,</span><span class="w"> </span><span class="n">IMDB_rating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IMDB_rating</span><span class="p">,</span><span class="w"> </span><span class="n">Full_Cast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Full_Cast</span><span class="p">))</span><span class="w">
  </span><span class="p">}))</span><span class="w">
</span><span class="p">}</span></code></pre></div>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">imdb_access</span> <span class="o">=</span> <span class="n">IMDb</span><span class="p">()</span></code></pre></div>

<p>Randy and I now have a working IMDb scraper. We can start collecting and organizing the data that we need.</p>

<p>First, let’s load the data we collected last time.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Load data from last challenge</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"movies-R.csv"</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">movie_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"movies.csv"</span><span class="p">)</span></code></pre></div>

<p>Then, we will extract the movie IMDb ID from the IMDb URL we collected last week. It’s easy, it’s the only number in the URL.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># For each movie, extract IMDb info and append it to the data</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">within</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># Extract ID number</span><span class="w">
  </span><span class="n">IMDB_ID</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"[^0-9]"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">IMDB_URL</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># Grab only the movie number out of the IMDB URL
</span><span class="n">movie_data</span><span class="p">[</span><span class="s">"Movie_Number"</span><span class="p">]</span> <span class="o">=</span> <span class="n">movie_data</span><span class="p">[</span><span class="s">"IMDB_URL"</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">"[^0-9]"</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></code></pre></div>

<p>Now that this is done, we will simply let the IMDb scraper collect the data we want and we will append it to the data from the first part of the challenge.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Download IMDb info into a temporary variable</span><span class="w">
  </span><span class="n">IMDB_Info</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">IMDb</span><span class="p">(</span><span class="n">IMDB_ID</span><span class="p">)</span><span class="w">

  </span><span class="c1"># Save MPAA rating</span><span class="w">
  </span><span class="n">MPAA_Rating</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">IMDB_Info</span><span class="o">$</span><span class="n">MPAA_Rating</span><span class="w">

  </span><span class="c1"># Save genre(s)</span><span class="w">
  </span><span class="n">Genre</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">IMDB_Info</span><span class="o">$</span><span class="n">Genre</span><span class="w">

  </span><span class="c1"># Save director(s)</span><span class="w">
  </span><span class="n">Director</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">IMDB_Info</span><span class="o">$</span><span class="n">Director</span><span class="w">

  </span><span class="c1"># Save duration in minutes</span><span class="w">
  </span><span class="n">Length_Minutes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">IMDB_Info</span><span class="o">$</span><span class="n">Length_Minutes</span><span class="w">

  </span><span class="c1"># Save IMDb rating</span><span class="w">
  </span><span class="n">IMDB_rating</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">IMDB_Info</span><span class="o">$</span><span class="n">IMDB_rating</span><span class="w">

  </span><span class="c1"># Save full cast</span><span class="w">
  </span><span class="n">Full_Cast</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">IMDB_Info</span><span class="o">$</span><span class="n">Full_Cast</span><span class="w">

  </span><span class="c1"># Delete IMDb info</span><span class="w">
  </span><span class="n">IMDB_Info</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="p">})</span></code></pre></div>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"film-death-counts-Python.csv"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Film,Year,Body_Count,MPAA_Rating,Genre,Director,Actors,Length_Minutes,IMDB_Rating</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">movie_entry</span> <span class="ow">in</span> <span class="n">movie_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="c1"># Use a try-catch on the loop to prevent temporary connection-related issues from stopping the scrape
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">movie</span> <span class="o">=</span> <span class="n">imdb_access</span><span class="o">.</span><span class="n">get_movie</span><span class="p">(</span><span class="n">movie_entry</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">"Movie_Number"</span><span class="p">])</span>
            <span class="n">movie_fields</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Remove non-ASCII character encodings and commas from movie titles
</span>            <span class="n">movie_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">movie</span><span class="p">[</span><span class="s">"title"</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"ascii"</span><span class="p">,</span> <span class="s">"replace"</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">","</span><span class="p">,</span> <span class="s">""</span><span class="p">))</span>
            <span class="n">movie_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">movie</span><span class="p">[</span><span class="s">"year"</span><span class="p">]))</span>
            <span class="n">movie_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">movie_entry</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">"Body_Count"</span><span class="p">]))</span>

            <span class="c1"># Some movies don't have MPAA Ratings on IMDB
</span>            <span class="k">try</span><span class="p">:</span>
              <span class="n">movie_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">movie</span><span class="p">[</span><span class="s">"mpaa"</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">except</span><span class="p">:</span>
              <span class="n">movie_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>

            <span class="c1"># For movies with multiple genres/directors/actors, join them with bars |
</span>            <span class="n">movie_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">"|"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">movie</span><span class="p">[</span><span class="s">"genres"</span><span class="p">])))</span>
            <span class="n">movie_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">"|"</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">movie</span><span class="p">[</span><span class="s">"director"</span><span class="p">]])))</span>
            <span class="n">movie_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">"|"</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">movie</span><span class="p">[</span><span class="s">"cast"</span><span class="p">]])))</span>

            <span class="n">movie_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">movie</span><span class="p">[</span><span class="s">"runtime"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">":"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
            <span class="n">movie_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">movie</span><span class="p">[</span><span class="s">"rating"</span><span class="p">])))</span></code></pre></div>

<p>And finally, all what is left to do is to save the complete data set into a .csv file and close the script.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">write.csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"movies-R-full.csv"</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># All entries are comma-delimited
</span>            <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">","</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">movie_fields</span><span class="p">)</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">"Error with"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span></code></pre></div>

<p>That’s it! You should now have a .csv file somewhere on your computer  containing all the information we just scraped in both parts of this challenge.</p>

<p>Sorry it took us so long to complete this part, but beginnings of semesters are always very busy times at the university.</p>

<p>Stay tuned for our next challenge! It will be about making a linear regression, running basic diagnostic tests and plotting the resulting straight line with its confidence interval.</p>

<hr />

<h4 id="source-code">3 - Source code</h4>

<p>R and Python source codes are available
<a href="https://github.com/morpionZ/R-vs-Python/tree/master/Deadliest%20movies%20scrape/code">here</a>.</p>


        <hr>

        <ul class="share-buttons">
          <li>Like it? Share it on: </li>
          <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.theswarmlab.com&t=The%20SwarmLab%20%40%20NJIT" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.URL) + '&t=' + encodeURIComponent(document.URL)); return false;"><img src="/img/share_buttons/Facebook.png"></a></li>
          <li><a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Fwww.theswarmlab.com&text=The%20SwarmLab%20%40%20NJIT:%20http%3A%2F%2Fwww.theswarmlab.com&via=sjmgarnier" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(document.title) + ':%20'  + encodeURIComponent(document.URL)); return false;"><img src="/img/share_buttons/Twitter.png"></a></li>
          <li><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.theswarmlab.com" target="_blank" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(document.URL)); return false;"><img src="/img/share_buttons/Google+.png"></a></li>
          <li><a href="http://www.tumblr.com/share?v=3&u=http%3A%2F%2Fwww.theswarmlab.com&t=The%20SwarmLab%20%40%20NJIT&s=" target="_blank" title="Post to Tumblr" onclick="window.open('http://www.tumblr.com/share?v=3&u=' + encodeURIComponent(document.URL) + '&t=' +  encodeURIComponent(document.title)); return false;"><img src="/img/share_buttons/Tumblr.png"></a></li>
          <li><a href="http://pinterest.com/pin/create/button/?url=http%3A%2F%2Fwww.theswarmlab.com&description=We%20are%20an%20interdisciplinary%20research%20lab%20that%20studies%20the%20mechanisms%20underlying%20the%20coordination%20of%20large%20animal%20groups%2C%20such%20as%20ant%20colonies%20or%20human%20crowds%2C%20and%20their%20applications%20to%20complex%20problems%20such%20the%20organization%20of%20pedestrian%20traffic%20or%20the%20control%20of%20robotic%20swarms." target="_blank" title="Pin it" onclick="window.open('http://pinterest.com/pin/create/button/?url=' + encodeURIComponent(document.URL) + '&description=' +  encodeURIComponent(document.title)); return false;"><img src="/img/share_buttons/Pinterest.png"></a></li>
          <li><a href="https://getpocket.com/save?url=http%3A%2F%2Fwww.theswarmlab.com&title=The%20SwarmLab%20%40%20NJIT" target="_blank" title="Add to Pocket" onclick="window.open('https://getpocket.com/save?url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="/img/share_buttons/Pocket.png"></a></li>
          <li><a href="http://www.reddit.com/submit?url=http%3A%2F%2Fwww.theswarmlab.com&title=The%20SwarmLab%20%40%20NJIT" target="_blank" title="Submit to Reddit" onclick="window.open('http://www.reddit.com/submit?url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="/img/share_buttons/Reddit.png"></a></li>
          <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww.theswarmlab.com&title=The%20SwarmLab%20%40%20NJIT&summary=We%20are%20an%20interdisciplinary%20research%20lab%20that%20studies%20the%20mechanisms%20underlying%20the%20coordination%20of%20large%20animal%20groups%2C%20such%20as%20ant%20colonies%20or%20human%20crowds%2C%20and%20their%20applications%20to%20complex%20problems%20such%20the%20organization%20of%20pedestrian%20traffic%20or%20the%20control%20of%20robotic%20swarms.&source=http%3A%2F%2Fwww.theswarmlab.com" target="_blank" title="Share on LinkedIn" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="/img/share_buttons/LinkedIn.png"></a></li>
          <li><a href="http://wordpress.com/press-this.php?u=http%3A%2F%2Fwww.theswarmlab.com&t=The%20SwarmLab%20%40%20NJIT&s=We%20are%20an%20interdisciplinary%20research%20lab%20that%20studies%20the%20mechanisms%20underlying%20the%20coordination%20of%20large%20animal%20groups%2C%20such%20as%20ant%20colonies%20or%20human%20crowds%2C%20and%20their%20applications%20to%20complex%20problems%20such%20the%20organization%20of%20pedestrian%20traffic%20or%20the%20control%20of%20robotic%20swarms." target="_blank" title="Publish on WordPress" onclick="window.open('http://wordpress.com/press-this.php?u=' + encodeURIComponent(document.URL) + '&t=' +  encodeURIComponent(document.title)); return false;"><img src="/img/share_buttons/Wordpress.png"></a></li>
          <li><a href="https://pinboard.in/popup_login/?url=http%3A%2F%2Fwww.theswarmlab.com&title=The%20SwarmLab%20%40%20NJIT&description=We%20are%20an%20interdisciplinary%20research%20lab%20that%20studies%20the%20mechanisms%20underlying%20the%20coordination%20of%20large%20animal%20groups%2C%20such%20as%20ant%20colonies%20or%20human%20crowds%2C%20and%20their%20applications%20to%20complex%20problems%20such%20the%20organization%20of%20pedestrian%20traffic%20or%20the%20control%20of%20robotic%20swarms." target="_blank" title="Save to Pinboard" onclick="window.open('https://pinboard.in/popup_login/?url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img src="/img/share_buttons/Pinboard.png"></a></li>
          <li><a href="mailto:?subject=The%20SwarmLab%20%40%20NJIT&body=We%20are%20an%20interdisciplinary%20research%20lab%20that%20studies%20the%20mechanisms%20underlying%20the%20coordination%20of%20large%20animal%20groups%2C%20such%20as%20ant%20colonies%20or%20human%20crowds%2C%20and%20their%20applications%20to%20complex%20problems%20such%20the%20organization%20of%20pedestrian%20traffic%20or%20the%20control%20of%20robotic%20swarms.:%20http%3A%2F%2Fwww.theswarmlab.com" target="_blank" title="Email" onclick="window.open('mailto:?subject=' + encodeURIComponent(document.title) + '&body=' +  encodeURIComponent(document.URL)); return false;"><img src="/img/share_buttons/Email.png"></a></li>
        </ul>

        <hr>

        <p>Categories:
            
                
                    <a href="/blog/">blog</a> &bull;
                
            
                
                    <a href="/category/rvspython/">rvspython</a> &bull;
                
            
                
                    <a href="/category/r/">r</a> &bull;
                
            
        </p>

        <hr>

        <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'theswarmlab';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

    </div>

</section>

<footer class="bg-darkest-gray">
    <div class="container">
        <span style="color: white">Subscribe <a href="http://www.theswarmlab.com/feed.xml">via RSS</a></span>
    </div>
</footer>

  <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <span class="copyright">Copyright &copy; Swarm Lab 2015</span>
                </div>
                <div class="col-md-4">
                    <ul class="list-inline social-buttons">
                        
                        <li><a href="https://twitter.com/sjmgarnier"><i class="fa fa-twitter"></i></a>
                        </li>
                        
                        <li><a href="https://plus.google.com/u/0/+SimonGarnier"><i class="fa fa-google-plus"></i></a>
                        </li>
                        
                        <li><a href="https://github.com/swarm-lab"><i class="fa fa-github"></i></a>
                        </li>
                        
                        <li><a href="https://www.linkedin.com/in/simongarnier"><i class="fa fa-linkedin"></i></a>
                        </li>
                        
                    </ul>
                </div>
                <div class="col-md-4">
                    <ul class="list-inline quicklinks">
                        <!--<li><a href="#">Privacy Policy</a>
                        </li>
                        <li><a href="#">Terms of Use</a>
                        </li>-->
                    </ul>
                </div>
            </div>
        </div>
    </footer>
 <!-- jQuery Version 1.11.0 -->
    <script src="/js/jquery-1.11.0.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="/js/jquery.easing.min.js"></script>
    <script src="/js/classie.js"></script>
    <script src="/js/cbpAnimatedHeader.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="/js/jqBootstrapValidation.js"></script>
    <script src="/js/contact_me.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/js/agency.js"></script>


</body>
</html>
